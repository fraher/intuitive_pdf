<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent0: The Riddle Master & The Detective</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1em;
            color: #555;
            max-width: 800px;
            text-align: center;
            margin-bottom: 30px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 20px;
            max-width: 1000px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #visualization {
            width: 100%;
            height: 500px;
            background-color: #fafafa;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: bold;
        }

        #btn-step { background-color: #3498db; color: white; }
        #btn-step:hover { background-color: #2980b9; }
        #btn-auto { background-color: #2ecc71; color: white; }
        #btn-auto:hover { background-color: #27ae60; }
        #btn-reset { background-color: #e74c3c; color: white; }
        #btn-reset:hover { background-color: #c0392b; }

        .info-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
            margin-top: 20px;
        }

        .panel-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid #ccc;
        }

        .panel-section.master { border-left-color: #9b59b6; }
        .panel-section.detective { border-left-color: #e67e22; }

        h3 { margin-top: 0; }

        .log-box {
            width: 100%;
            height: 150px;
            background: #2d3436;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 10px;
            border-radius: 5px;
            overflow-y: auto;
            font-size: 14px;
            margin-top: 20px;
        }

        /* SVG Styles */
        .agent-group { cursor: pointer; transition: transform 0.2s; }
        .agent-group:hover { transform: scale(1.05); }
        
        .scroll { fill: #f1c40f; stroke: #f39c12; stroke-width: 2; }
        .gadget { fill: #34495e; }
        
        .thought-bubble { fill: white; stroke: #bdc3c7; stroke-width: 2; opacity: 0; transition: opacity 0.5s; }
        .thought-text { font-size: 12px; fill: #333; opacity: 0; transition: opacity 0.5s; }
        
        .score-bar { transition: height 0.5s ease-out; }

        .connection-line { stroke: #bdc3c7; stroke-width: 2; stroke-dasharray: 5,5; }
        
        .particle { pointer-events: none; }

    </style>
</head>
<body>

    <h1>Agent0: The Self-Evolving Loop</h1>
    <div class="subtitle">
        An interactive analogy based on the paper "Agent0: Unleashing Self-Evolving Agents from Zero Data".
        <br>
        <strong>The Riddle Master (Curriculum Agent)</strong> creates puzzles to challenge <strong>The Detective (Executor Agent)</strong>.
        <br>
        They grow smarter together without any outside help.
    </div>

    <div class="container">
        <div class="controls">
            <button id="btn-step">Run Cycle</button>
            <button id="btn-auto">Auto Play</button>
            <button id="btn-reset">Reset</button>
        </div>

        <div id="visualization">
            <svg width="100%" height="100%" viewBox="0 0 800 500" id="main-svg">
                <!-- Background Elements -->
                <defs>
                    <filter id="glow">
                        <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>

                <!-- Connection Lines -->
                <path d="M 200 250 L 600 250" class="connection-line" />

                <!-- Riddle Master (Curriculum Agent) -->
                <g id="master-group" class="agent-group" transform="translate(150, 250)">
                    <circle cx="0" cy="0" r="60" fill="#9b59b6" stroke="#8e44ad" stroke-width="4" />
                    <text x="0" y="5" text-anchor="middle" fill="white" font-size="40">üßô‚Äç‚ôÇÔ∏è</text>
                    <text x="0" y="85" text-anchor="middle" fill="#2c3e50" font-weight="bold">Riddle Master</text>
                    <text x="0" y="105" text-anchor="middle" fill="#7f8c8d" font-size="12">(Curriculum Agent)</text>
                    
                    <!-- Master Stats -->
                    <rect x="-70" y="-100" width="140" height="20" fill="#ecf0f1" rx="5" />
                    <rect id="master-xp-bar" x="-70" y="-100" width="10" height="20" fill="#9b59b6" rx="5" />
                    <text x="0" y="-110" text-anchor="middle" font-size="12" fill="#555">Complexity Level</text>
                </g>

                <!-- Detective (Executor Agent) -->
                <g id="detective-group" class="agent-group" transform="translate(650, 250)">
                    <circle cx="0" cy="0" r="60" fill="#e67e22" stroke="#d35400" stroke-width="4" />
                    <text x="0" y="5" text-anchor="middle" fill="white" font-size="40">üïµÔ∏è‚Äç‚ôÄÔ∏è</text>
                    <text x="0" y="85" text-anchor="middle" fill="#2c3e50" font-weight="bold">Detective</text>
                    <text x="0" y="105" text-anchor="middle" fill="#7f8c8d" font-size="12">(Executor Agent)</text>

                    <!-- Detective Stats -->
                    <rect x="-70" y="-100" width="140" height="20" fill="#ecf0f1" rx="5" />
                    <rect id="detective-xp-bar" x="-70" y="-100" width="10" height="20" fill="#e67e22" rx="5" />
                    <text x="0" y="-110" text-anchor="middle" font-size="12" fill="#555">Skill Level</text>
                </g>

                <!-- The Scroll (Task) -->
                <g id="scroll-obj" transform="translate(150, 250) scale(0)">
                    <rect x="-20" y="-15" width="40" height="30" rx="2" class="scroll" />
                    <line x1="-15" y1="-5" x2="15" y2="-5" stroke="#d35400" stroke-width="2" />
                    <line x1="-15" y1="5" x2="5" y2="5" stroke="#d35400" stroke-width="2" />
                </g>

                <!-- The Gadget (Tool) -->
                <g id="gadget-obj" transform="translate(650, 150)" opacity="0">
                    <rect x="-20" y="-20" width="40" height="40" rx="5" fill="#34495e" />
                    <rect x="-15" y="-15" width="30" height="20" fill="#2ecc71" />
                    <circle cx="0" cy="10" r="5" fill="#95a5a6" />
                </g>

                <!-- Thought Bubbles -->
                <g id="master-thought" transform="translate(150, 150)">
                    <ellipse cx="0" cy="0" rx="60" ry="40" class="thought-bubble" />
                    <text x="0" y="5" text-anchor="middle" class="thought-text" id="master-thought-text">Generating...</text>
                </g>

                <g id="detective-thought" transform="translate(650, 150)">
                    <ellipse cx="0" cy="0" rx="60" ry="40" class="thought-bubble" />
                    <text x="0" y="5" text-anchor="middle" class="thought-text" id="detective-thought-text">Solving...</text>
                </g>

                <!-- Feedback Particles -->
                <g id="particles"></g>

            </svg>
        </div>

        <div class="info-panel">
            <div class="panel-section master">
                <h3>üßô‚Äç‚ôÇÔ∏è The Riddle Master</h3>
                <p><strong>Goal:</strong> Create riddles that are <em>just right</em>.</p>
                <p><strong>Rewards:</strong>
                    <ul>
                        <li><strong>Confusion:</strong> If the Detective is unsure (waffles between answers).</li>
                        <li><strong>Gadget Use:</strong> If the Detective MUST use tools to solve it.</li>
                    </ul>
                </p>
                <p><em>"If it's too easy, I learn nothing. If it's impossible, I learn nothing. I need the sweet spot."</em></p>
            </div>
            <div class="panel-section detective">
                <h3>üïµÔ∏è‚Äç‚ôÄÔ∏è The Detective</h3>
                <p><strong>Goal:</strong> Solve the riddles correctly.</p>
                <p><strong>Method:</strong>
                    <ul>
                        <li><strong>Reasoning:</strong> Thinking through the problem step-by-step.</li>
                        <li><strong>Tools:</strong> Using the "Gadget Belt" (Python Interpreter) for hard math/logic.</li>
                        <li><strong>Self-Consistency:</strong> Asking "inner voices" to vote on the best answer.</li>
                    </ul>
                </p>
            </div>
        </div>

        <div class="log-box" id="log-output">
            > System initialized.
            > Ready to start evolution cycle.
        </div>
    </div>

    <script>
        // State
        let step = 0; // 0: Idle, 1: Generating, 2: Transferring, 3: Solving, 4: Rewarding
        let iteration = 1;
        let masterXP = 10;
        let detectiveXP = 10;
        let autoPlay = false;
        let isRunning = false;

        // DOM Elements
        const svg = document.getElementById('main-svg');
        const scrollObj = document.getElementById('scroll-obj');
        const gadgetObj = document.getElementById('gadget-obj');
        const masterThought = document.getElementById('master-thought').querySelector('.thought-bubble');
        const masterText = document.getElementById('master-thought-text');
        const detectiveThought = document.getElementById('detective-thought').querySelector('.thought-bubble');
        const detectiveText = document.getElementById('detective-thought-text');
        const logOutput = document.getElementById('log-output');
        const masterXpBar = document.getElementById('master-xp-bar');
        const detectiveXpBar = document.getElementById('detective-xp-bar');
        const btnStep = document.getElementById('btn-step');
        const btnAuto = document.getElementById('btn-auto');

        function log(msg) {
            const line = document.createElement('div');
            line.textContent = `> [Cycle ${iteration}] ${msg}`;
            logOutput.appendChild(line);
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        function setThought(agent, text, show) {
            const bubble = agent === 'master' ? masterThought : detectiveThought;
            const txt = agent === 'master' ? masterText : detectiveText;
            
            txt.textContent = text;
            bubble.style.opacity = show ? 1 : 0;
            txt.style.opacity = show ? 1 : 0;
        }

        function animateScrollTransfer(callback) {
            let start = Date.now();
            let duration = 1000;
            
            function frame() {
                let now = Date.now();
                let progress = (now - start) / duration;
                if (progress > 1) progress = 1;
                
                // Move from 150 to 650
                let x = 150 + (650 - 150) * progress;
                // Arc y slightly
                let y = 250 - Math.sin(progress * Math.PI) * 50;
                
                scrollObj.setAttribute('transform', `translate(${x}, ${y}) scale(1)`);
                
                if (progress < 1) {
                    requestAnimationFrame(frame);
                } else {
                    if (callback) callback();
                }
            }
            requestAnimationFrame(frame);
        }

        function animateGadget() {
            gadgetObj.style.transition = "opacity 0.5s";
            gadgetObj.setAttribute('opacity', 1);
            
            // Flash effect
            setTimeout(() => {
                gadgetObj.querySelector('rect:nth-child(2)').setAttribute('fill', '#00ff00');
            }, 500);
            setTimeout(() => {
                gadgetObj.querySelector('rect:nth-child(2)').setAttribute('fill', '#2ecc71');
            }, 800);
            setTimeout(() => {
                gadgetObj.setAttribute('opacity', 0);
            }, 1500);
        }

        function updateBars() {
            masterXpBar.setAttribute('width', Math.min(140, masterXP));
            detectiveXpBar.setAttribute('width', Math.min(140, detectiveXP));
        }

        function runCycle() {
            if (isRunning && !autoPlay) return; // Prevent double clicks
            
            // Stop condition
            if (masterXP >= 140 && detectiveXP >= 140) {
                log(">>> CONVERGENCE REACHED! Agents are fully evolved.");
                autoPlay = false;
                isRunning = false;
                btnAuto.textContent = "Auto Play";
                btnStep.disabled = false;
                btnStep.textContent = "Run Cycle";
                return;
            }

            isRunning = true;
            btnStep.disabled = true;
            btnStep.textContent = "Running...";

            // Step 1: Generate
            step = 1;
            log("Riddle Master is crafting a new task...");
            setThought('master', "Designing Task...", true);
            scrollObj.setAttribute('transform', 'translate(150, 250) scale(0)');
            
            setTimeout(() => {
                setThought('master', "", false);
                scrollObj.setAttribute('transform', 'translate(150, 250) scale(1)');
                
                // Step 2: Transfer
                step = 2;
                log("Task sent to Detective.");
                
                animateScrollTransfer(() => {
                    // Step 3: Solve
                    step = 3;
                    log("Detective is thinking...");
                    setThought('detective', "Analyzing...", true);
                    
                    setTimeout(() => {
                        // Determine Scenario
                        // 0: Too Easy (30%)
                        // 1: Confusing/Hard (30%)
                        // 2: Perfect/Tool (40%)
                        const rand = Math.random();
                        let scenario = 0;
                        if (rand < 0.3) scenario = 0;
                        else if (rand < 0.6) scenario = 1;
                        else scenario = 2;

                        // Override for early iterations to show failure
                        if (iteration === 1) scenario = 0; // Start easy
                        if (iteration === 2) scenario = 1; // Then hard

                        const finishSolve = (outcomeMsg, mXP, dXP) => {
                            // Step 4: Reward & Evolve
                            step = 4;
                            setThought('detective', "", false);
                            scrollObj.setAttribute('transform', 'translate(650, 250) scale(0)'); // Hide scroll
                            
                            log("Calculating Rewards...");
                            log(outcomeMsg);
                            
                            masterXP += mXP;
                            detectiveXP += dXP;
                            iteration++;
                            updateBars();
                            
                            setTimeout(() => {
                                step = 0;
                                isRunning = false;
                                btnStep.disabled = false;
                                btnStep.textContent = "Run Cycle";
                                
                                if (autoPlay) {
                                    runCycle();
                                }
                            }, 1000);
                        };

                        if (scenario === 0) {
                            // Too Easy
                            log("Task was trivial.");
                            setThought('detective', "Too easy!", true);
                            setTimeout(() => {
                                finishSolve("Result: Too Easy. Master gets NO XP. Detective gets small XP.", 0, 5);
                            }, 1000);
                        } else if (scenario === 1) {
                            // Confusing
                            log("Task is poorly defined or too abstract.");
                            setThought('detective', "???", true);
                            setTimeout(() => {
                                finishSolve("Result: Confusion. Master gets Uncertainty XP. Detective learns little.", 15, 2);
                            }, 1500);
                        } else {
                            // Perfect / Tool
                            log("Task is complex! Using Gadget...");
                            setThought('detective', "Using Tool...", true);
                            animateGadget();
                            setTimeout(() => {
                                setThought('detective', "Solved!", true);
                                setTimeout(() => {
                                    finishSolve("Result: Perfect Challenge! Both gain High XP.", 20, 20);
                                }, 1000);
                            }, 2000);
                        }
                    }, 1500);
                });
            }, 1500);
        }

        // Event Listeners
        btnStep.addEventListener('click', () => {
            if (!isRunning) {
                runCycle();
            }
        });

        btnAuto.addEventListener('click', () => {
            autoPlay = !autoPlay;
            btnAuto.textContent = autoPlay ? "Stop Auto" : "Auto Play";
            if (autoPlay && !isRunning) runCycle();
        });

        document.getElementById('btn-reset').addEventListener('click', () => {
            autoPlay = false;
            isRunning = false;
            btnAuto.textContent = "Auto Play";
            btnStep.disabled = false;
            btnStep.textContent = "Run Cycle";
            
            step = 0;
            iteration = 1;
            masterXP = 10;
            detectiveXP = 10;
            updateBars();
            logOutput.innerHTML = "";
            log("System reset.");
            scrollObj.setAttribute('transform', 'translate(150, 250) scale(0)');
            setThought('master', "", false);
            setThought('detective', "", false);
            gadgetObj.setAttribute('opacity', 0);
        });

    </script>
</body>
</html>